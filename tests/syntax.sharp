mod app;

import std.io;
import std.io.task;

/**
*
*/

class network {
    private INSTANCE : network;
     get { return null; }

    num : int;

    def foo() {

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































        INSTANCE.num.to_string();
    }
}

def send(str: string)
{
    send(str.get_data());
}

disconnected  := false;
times := 0;
def main(args: string[]) : var {
    set_thread_max(3);
    jb := task.builder()
        .long_term()
        .recurring(50, milliseconds) = { args: object[] ->
            if(!disconnected)
               for(i := 0; i < 100; i++) {}
        };

        task.builder()
                .recurring(1000, milliseconds) = { args: object[] ->
                    jb := args[0] as job;
                    if(disconnected)
                     for(i := 0; i < 10; i++) {}
                };
        task.builder()
                .recurring(250, milliseconds) = { args: object[] ->
                    jb := args[0] as job;
                    disconnected = (times++ % 100) == 0;
                    if(times > 100) times = 0;
                    for(i := 0; i < 1000; i++) {}
                };


    while(true) {
        thread.yield();
        thread.sleep(1);
        }
    return 4;
}
