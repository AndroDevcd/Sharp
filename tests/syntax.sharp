mod app;

import std.io.*;
import platform;
import platform.kernel;

chan := new channel<var>(UNLIMITED);
const loop_count := 1000000;
const slices := 10;
const n := 0;
counter := new atomic<var>{ 0 };

def main(args: string[]) {

    for(i := 0; i < slices; i++) {
        slice({ args ->
            for(i := 0; i < loop_count; i++) {
                counter++;
            }

            println("done");
            return 0;
        }, thread.current());
    }

    for(i := 0; i < loop_count; i++) {
       counter++;
    }

    // took 8.288s
    while(counter != (loop_count * (slices + 1))) {
        delay(10);
    }
}
