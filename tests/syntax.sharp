mod app;

import std.io.*;
import platform;
import platform.kernel;

chan := new channel<var>(UNLIMITED);
const loop_count := 1000;
const slices := 10;
const n := 0;
counter := new atomic<var>{ 0 };

def main(args: string[]) {

    for(i := 0; i < slices; i++) {
        launcher = { ->
            for(i := 0; i < 10000000; i++) {
            }

            counter++;
        };
    }

    for(i := 0; i < 10000000; i++) {
    }

    while(counter < slices) {
        delay(100);
    }

    println("done");

    // took 8.288s
}
