mod app;

import std.io;
import std.io.task;
import std.io.fiber;
import platform;
import platform.kernel;

chan := new channel<var>(UNLIMITED);
task_count := 10000;
counter := new atomic<var>{ 0 };

def foo() : var {
    for(i := 0; i < task_count; i++) {
        if(i % 100 == 0) {
           println(i);
        }

        launcher = {->
           for( ;; ) {
              counter++;
              delay(1000);
           }
        };
    }

    return 0;
}

def main(args: string[]) {
   foo();
   delay(15000);
}
