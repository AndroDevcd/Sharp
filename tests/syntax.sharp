mod app;

import std.io;
import std.io.task;
import std.io.fiber;
import platform;

chan := new channel<var>(BUFFERED, 2);

def channel_test(args: object[]) : var {
   for(i := 0; i < 1000; i++)
      println("$i");

   return 1;
}

def channel_test2(args: object[]) : var {
   foreach(data in chan) {
      println("test: ${data}");
   }

   return 1;
}

def main(args: string[]) {
    //fib := slice(channel_test, thread.current());

    for(i := 0; i < 10_000; i++) {

        if(i == 9000) {
           fib := fiber.current();
           println("state: ${fib.get_state()}");
           fib.kill();
        }
    }

    println("done");
}
